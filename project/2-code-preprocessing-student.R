# @head: MECAI | MAI5024
# @auth: Andre Perez
# @mail: andre.marcos.perez@usp.br

# ------------------------------------------------------------------------------
# -- Clean ---------------------------------------------------------------------
# ------------------------------------------------------------------------------

rm(list=ls())
cat("\014")

# ------------------------------------------------------------------------------
# -- Variable ------------------------------------------------------------------
# ------------------------------------------------------------------------------

# -- Environment

PATH.INPUT  <- "dataset"
PATH.OUTPUT <- "dataset"
FILE.INPUT  <- "kaggle-etl.csv"

# -- Script

# ------------------------------------------------------------------------------
# -- Library -------------------------------------------------------------------
# ------------------------------------------------------------------------------

if (!require("sqldf")) {
  install.packages("sqldf");
  library("sqldf");
}

# ------------------------------------------------------------------------------
# -- Functions -----------------------------------------------------------------
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# -- Main ----------------------------------------------------------------------
# ------------------------------------------------------------------------------

data <- read.csv(file.path(PATH.INPUT, FILE.INPUT), na.strings=c("NA"), encoding="latin1", stringsAsFactors = FALSE);

# ----------------------------------------
# -- Feature Engineering -----------------
# ----------------------------------------

# Drop rows

data <- sqldf("select * from data where Job = 'Student'");

# Drop sensible cols 

data$Age <- NULL;
data$Gender <- NULL;

# Drop cols

data$Job <- NULL;

# TBD

data$Education <- NULL;
data$TimeCoding <- NULL;
data$DataCoding <- NULL;
data$Experience <- NULL;
data$MLYearCoding <- NULL;
data$Undergraduate <- NULL;

# Dummy non tech vars

for (index in 1:nrow(data)) {
  
  # gender
  
  #feature <- data$Gender[index];
  
  #if (feature == "Male") {
  #  data$Gender[index] <- 1;
  #}
  #else{
  #  data$Gender[index] <- 0;
  #}
}

# Dummy tech vars

for (index in 1:ncol(data)) {
  feature <- data[index];
  feature[!is.na(feature)] <- 1;
  feature[is.na(feature)]  <- 0;
  data[index] <- feature;
}

# save engineerd dataframe

write.csv(data, file=file.path(PATH.OUTPUT, "kaggle-preprocessing-student.csv"), row.names=FALSE);

# ------------------------------------------------------------------------------
# -- Clean ---------------------------------------------------------------------
# ------------------------------------------------------------------------------

rm(list = c("FILE.INPUT", "PATH.INPUT", "PATH.OUTPUT"));
rm(list = c("index", "feature"));

# ------------------------------------------------------------------------------
# -- Done ---------------------------------------------------------------------
# ------------------------------------------------------------------------------

print("# ---------------------------------------------------------------------")
print("# -- Done -------------------------------------------------------------")
print("# ---------------------------------------------------------------------")